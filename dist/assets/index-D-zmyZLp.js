import{e as z,f as R,g as m,h as V,i as q,m as D,w as o,r as c,b as H,o as P,d as s,a as d,k as g,v,l as w}from"./index-RO7SmJEO.js";const $=["src"],A={class:"captcha"},E={__name:"index",setup(M){const e=z({username:"",password:"",remember:!0}),x=t=>{console.log("Success:",t),S()},b=t=>{console.log("Failed:",t)};let u=null;const f=()=>{u&&(u&&clearTimeout(u),u=null)},y=(t,a)=>{f();const n=t-a;if(n<=0){e.expired=!0;return}u=setTimeout(()=>{e.expired=!0,i()},n)};R(f);const _=m(""),i=async()=>{const t=await $fetch({url:"/captcha/image"});t.data.success&&(console.log(t.data),_.value=t.data.data.img,e.uuid=t.data.data.uuid,e.expired=!1,y(t.data.data.expireTime,t.data.timestamp))},h=m(!1),k=m(),T=V(),U=H(),B=()=>{U.replace("/home")},C=()=>{i(),e.captcha=""},O=()=>{h.value=!1},S=async()=>{var p;if(await((p=k.value)==null?void 0:p.validate()))return;h.value=!0;const a="ef51c9a3e9046c4f2ea45142c8a8344a",n=$encrypt.encryptByRsa(e.password),r={authType:"ACCOUNT",captcha:e.captcha,clientId:a,password:n,username:e.username,uuid:e.uuid};T.accountLogin(r).then(B).catch(C).finally(O)};return q(async()=>{await i()}),(t,a)=>{const n=c("a-input"),r=c("a-form-item"),p=c("a-input-password"),L=c("HighlightOutlined"),F=c("a-checkbox"),I=c("a-button"),N=c("a-form");return P(),D(N,{model:e,name:"basic","label-col":{span:8},"wrapper-col":{span:12},autocomplete:"off",onFinish:x,onFinishFailed:b},{default:o(()=>[s(r,{label:"用户名",name:"username",rules:[{required:!0,message:"Please input your username!"}]},{default:o(()=>[s(n,{size:"large",value:e.username,"onUpdate:value":a[0]||(a[0]=l=>e.username=l)},null,8,["value"])]),_:1}),s(r,{label:"密码",name:"password",rules:[{required:!0,message:"Please input your password!"}]},{default:o(()=>[s(p,{size:"large",value:e.password,"onUpdate:value":a[1]||(a[1]=l=>e.password=l)},null,8,["value"])]),_:1}),s(r,{label:"验证码",name:"captcha"},{default:o(()=>[s(n,{size:"large",value:e.captcha,"onUpdate:value":a[2]||(a[2]=l=>e.captcha=l),placeholder:"请输入验证码"},{prefix:o(()=>[s(L)]),suffix:o(()=>[d("div",{class:"captcha-container",onClick:i,style:{"max-height":"23px"}},[g(d("img",{src:_.value,style:{"max-height":"23px"},alt:"验证码",class:"captcha"},null,8,$),[[v,!e.expired]]),g(d("div",A,a[4]||(a[4]=[d("p",null,"已过期，请刷新",-1)]),512),[[v,e.expired]])])]),_:1},8,["value"])]),_:1}),s(r,{name:"remember","wrapper-col":{offset:8,span:16}},{default:o(()=>[s(F,{checked:e.remember,"onUpdate:checked":a[3]||(a[3]=l=>e.remember=l)},{default:o(()=>a[5]||(a[5]=[w("记住我")])),_:1,__:[5]},8,["checked"])]),_:1}),s(r,{"wrapper-col":{offset:8,span:16}},{default:o(()=>[s(I,{type:"primary","html-type":"submit"},{default:o(()=>a[6]||(a[6]=[w("Submit")])),_:1,__:[6]})]),_:1})]),_:1},8,["model"])}}};export{E as default};
